name: Staging Deployment

on:
  push:
    branches:
      - main

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: '0'

    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v3
      with:
        hugo-version: '0.143.0'
        extended: true
    
    - name: Sync Hugo theme
      run: git submodule update

    - name: Build Hugo
      working-directory: blog
      run: |
        hugo build
        tree .

    - name: git-ftp-action
      uses: sebastianpopp/git-ftp-action@3.0.0
      with:
        # URL
        url: "${{ secrets.FTP_SERVER}}/${{ secrets.STAGING_FTP_DIR}}/"
        syncroot: "blog/public"
        # FTP login name
        user: "${{ secrets.FTP_USERNAME }}"
        # FTP password
        password: "${{ secrets.FTP_PASSWORD }}"